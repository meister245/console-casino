class ConsoleCasino{constructor(t){this.roulette=new RouletteBot(this.getDriver(t))}getDriver(t){switch(t){case"playtech":return new Playtech;default:throw new Error(`invalid driver name ${t}`)}}}const serverPort=8080,serverHostname="localhost",serverUrl="http://localhost:8080",gameState={stageBet:"stage-bet",stageSpin:"stage-spin",stageWait:"stage-wait",stageResults:"stage-results"},rouletteNumbers={red:[1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36],black:[2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35],low:[...Array(18).keys()].map((t=>t+1)),high:[...Array(18).keys()].map((t=>t+19)),odd:[...Array(18).keys()].map((t=>2*(t+1)-1)),even:[...Array(18).keys()].map((t=>2*(t+1))),dozenFirst:[...Array(12).keys()].map((t=>t+1)),dozenSecond:[...Array(12).keys()].map((t=>t+13)),dozenThird:[...Array(12).keys()].map((t=>t+25)),columnTop:[...Array(12).keys()].map((t=>3*(t+1))),columnMiddle:[...Array(12).keys()].map((t=>3*(t+1)-1)),columnBottom:[...Array(12).keys()].map((t=>3*(t+1)-2))};class BetManager{constructor(){this.lastBetTime=Math.floor(Date.now()/1e3)}async requestBet(){return fetch(`${serverUrl}/bet/`,{method:"POST",mode:"cors"}).then((t=>t.json()))}async reportResult(t,e){if(!["win","lose","abort"].includes(t))throw new Error("invalid result");const s={result:t,strategy:e?.strategy,multiplier:e?.multiplier.current};return fetch(`${serverUrl}/result/`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s})}).then((t=>t.json()))}updateLastBetTime(){this.lastBetTime=Math.floor(Date.now()/1e3)}}class RouletteBetManager extends BetManager{constructor(t,e,s){super(),this.driver=t,this.config=e,this.strategy=s,this.lastLogMessage=null,this.state={gameCount:0,pendingGame:null,gameStage:gameState.stageSpin}}async runStrategy(){const t=this.driver.getModalMessage(),e=Math.floor(Date.now()/1e3)-this.lastBetTime;if(!this.state.pendingGame&&e>1500)return void window.location.reload();if(t.match(/(inactive|disconnected|restart|unavailable)/g))return this.state.pendingGame&&await this.reportResult("abort",this.state.pendingGame),void window.location.reload();if(t.match(/table.will.be.closed/g))return void(this.state.pendingGame&&await this.reportResult("abort",this.state.pendingGame));const s=this.driver.getLastNumber(),a=this.driver.getDealerMessage().toLowerCase();switch(this.state.gameStage){case gameState.stageSpin:this.runStageSpin(a);break;case gameState.stageBet:await this.runStageBet(a);break;case gameState.stageWait:this.runStageWait(a);break;case gameState.stageResults:await this.runStageResult(a,s)}}runStageSpin(t){this.logMessage("waiting for next round"),"wait for the next round"===t&&(this.state.gameStage=gameState.stageBet)}async runStageBet(t){if(this.logMessage("waiting to be able to place bets"),["place your bets","last bets"].includes(t)){if(null===this.state.pendingGame){this.logMessage("no bets in progress");const t=this.driver.getNumberHistory();for(const e in this.strategy){const s=this.strategy[e];let a=!1,i=!1;if(this.isPatternMatching(s.trigger.pattern,t)&&(a=!0),this.isPercentageMatching(s.trigger.distribution,t)&&(i=!0),a&&i){this.logMessage("strategy matched - "+e);(await this.requestBet()).success?(this.logMessage("server accepted bet"),this.state.pendingGame={bets:s.bets,progression:s.progression,strategy:e,multiplier:{current:1,limit:s.stopLossLimit}},this.submitBets()):this.logMessage("server refused bet");break}}}else this.logMessage("continue with betting"),this.submitBets();this.state.gameStage=gameState.stageWait}}runStageWait(t){this.logMessage("waiting for next round"),"wait for the next round"===t&&(this.state.gameStage=gameState.stageResults)}async runStageResult(t,e){if(this.logMessage("waiting for result"),["place your bets","last bets"].includes(t)){if(this.logMessage("processing results"),this.state.pendingGame){const t=this.getWinTypes(e),s=this.strategy[this.state.pendingGame.strategy];let a=!1;if(s.bets.forEach((e=>{t.includes(e)&&(a=!0)})),a){(await this.reportResult("win",this.state.pendingGame)).success&&this.logMessage("registered win, resetting state"),this.state.gameCount+=1,this.state.pendingGame=null}else if(this.state.pendingGame.multiplier.current!==this.state.pendingGame.multiplier.limit)this.state.pendingGame.multiplier.current+=1,this.logMessage("lost game, increasing progression multiplier");else{(await this.reportResult("lose",this.state.pendingGame)).success&&this.logMessage("registered loss"),window.location.href="https://www.scienceabc.com/wp-content/uploads/ext-www.scienceabc.com/wp-content/uploads/2019/06/bankruptcy-meme.jpg-.jpg"}}this.state.gameStage=gameState.stageBet}}submitBets(){let t=0;!this.config.dryRun&&this.driver.setChipSize(this.config.chipSize),this.state.pendingGame.bets.forEach((e=>{!this.config.dryRun&&this.driver.setBet(e),t+=this.config.chipSize}));for(let e=1;e<this.state.pendingGame.multiplier.current;e++)!this.config.dryRun&&this.driver.setBetDouble(),t*=2;!this.config.dryRun&&this.updateLastBetTime(),this.logMessage("bets: "+this.state.pendingGame.bets),this.logMessage("total: "+t)}isPercentageMatching(t,e){const s=t[0],a=t[1],i=t[2],r=t[3],n=rouletteNumbers[s],o=e.slice(0,a);let l=0;o.forEach((t=>{n.includes(t)&&(l+=1)}));const c=Math.floor(l/o.length*100);switch(r){case"lowerEqual":return c<=i;case"equal":return c===i;case"higherEqual":return c>=i;default:return!1}}isPatternMatching(t,e){for(const s in t){const a=t[s],i=e[s];if(!this.getWinTypes(i).includes(a))return!1}return!0}getWinTypes(t){const e=[];for(const s in rouletteNumbers)rouletteNumbers[s].includes(t)&&e.push(s);return e}logMessage(t){const e=["console-casino",this.state.gameStage,this.state.gameCount,t];e.toString()!==this.lastLogMessage&&(this.lastLogMessage=e.toString(),console.log(e.join(" - ")))}}class CommonBot{constructor(t){this.driver=t,this.running=!1,this.timeStarted=Math.floor(Date.now()/1e3)}async getConfig(t){return fetch(`${serverUrl}/config/?game=${t}`).then((t=>t.json()))}}class RouletteBot extends CommonBot{async start(){const{config:t,strategy:e}=await this.getConfig("roulette");for(;!this.driver.getDealerMessage();)await this.driver.sleep(1500);const s=await this.driver.getBalance();if(!t.dryRun&&t.minBalance>s)throw new Error("balance too low");if(this.running)throw new Error("already started");this.running=!0;const a=new RouletteBetManager(this.driver,t,e);for(;this.running;)await a.runStrategy(),await this.driver.sleep(1500)}async stop(){this.running=!1}}class DriverCommon{simulatedClick(t,e){const s=t.ownerDocument.createEvent("MouseEvents"),a=e||{},i={type:"click",canBubble:!0,cancelable:!0,view:t.ownerDocument.defaultView,detail:1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null};for(const t in a)t in a&&(i[t]=a[t]);s.initMouseEvent(i.type,i.canBubble,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget),t.dispatchEvent(s)}sleep(t){return new Promise((e=>setTimeout(e,t)))}}class Playtech extends DriverCommon{constructor(){super(),this.selectors={chip:{.1:"chipsPanel.chip10",.2:"chipsPanel.chip20",.25:"chipsPanel.chip25",.5:"chipsPanel.chip50",1:"chipsPanel.chip100",5:"chipsPanel.chip500",10:"chipsPanel.chip1000",25:"chipsPanel.chip2500",100:"chipsPanel.chip10000",500:"chipsPanel.chip50000",1e3:"chipsPanel.chip100000"},roulette:{even:"betPlace.spots50x50-even",odd:"betPlace.spots50x50-odd",red:"betPlace.spots50x50-red",black:"betPlace.spots50x50-black",low:"betPlace.spots50x50-1to18",high:"betPlace.spots50x50-19to36",columnBottom:"betPlace.column-1",columnMiddle:"betPlace.column-2",columnTop:"betPlace.column-3",firstDozen:"betPlace.dozen-1st12",secondDozen:"betPlace.dozen-2nd12",thirdDozen:"betPlace.dozen-3rd12"}}}getModalMessage(){return document.querySelector(".modal-confirm_desktop")?.textContent??""}getBalance(){const t=document.querySelector('[data-automation-locator="footer.balance"]').textContent;return parseFloat(t.match(/\d+(?:\.\d+)*/g)[0])}getBetAmount(){const t=document.querySelector('[data-automation-locator="footer.betAmount"]').textContent;return parseFloat(t.match(/\d+(?:\.\d+)*/g)[0])}getDealerMessage(){return document.querySelector('[class="dealer-message-text"]')?.textContent??""}getDealerName(){return document.querySelector('[data-automation-locator="field.dealerNickname"]')?.textContent??""}getNumberHistory(){try{return[...document.querySelector('[class^="roulette-history-extended__items"]').children].map((t=>parseInt(t.textContent)))}catch{this.toggleExtendedHistory();return[...document.querySelector('[class^="roulette-history-extended__items"]').children].map((t=>parseInt(t.textContent)))}}getLastNumber(){const t=document.querySelector('[data-automation-locator="field.lastHistoryItem"]');return parseInt(t.textContent)}getLastNumbers(){return[...document.querySelector(".roulette-game-area__history-line").children[0].children].map((t=>parseInt(t.textContent)))}getWinAmount(){const t=document.querySelector('[data-automation-locator="footer.winAmount"]');return parseFloat(t.textContent.match(/[0-9]+(?:\.[0-9]+)*/g)[0])}setBet(t){this.simulatedClick(document.querySelector(`[data-automation-locator="${this.selectors.roulette[t]}"]`))}setBetDouble(){this.simulatedClick(document.querySelector('[data-automation-locator="button.Double"]'))}setBetUndo(){this.simulatedClick(document.querySelector('[data-automation-locator="button.Undo"]'))}setChipSize(t){this.simulatedClick(document.querySelector(`[data-automation-locator="${this.selectors.chip[t]}"]`))}toggleTableLimits(){this.simulatedClick(document.querySelector('[data-automation-locator="button.limits"]'))}toggleExtendedHistory(){this.simulatedClick(document.querySelector('[data-automation-locator="button.extenededHistory"]'))}toggleStatistics(){this.simulatedClick(document.querySelector('[data-automation-locator="button.statistic"]'))}toggleStatisticsChart(){this.simulatedClick(document.querySelector('[data-automation-locator="button.StatisticChart"]'))}}