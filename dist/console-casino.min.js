class ConsoleCasino{constructor(e){this.roulette=new RouletteBot(this.getDriver(e))}getDriver(e){switch(e){case"playtech":return new Playtech;default:throw new Error(`invalid driver name ${e}`)}}}const gameState={stageBet:"stage-bet",stageSpin:"stage-spin",stageWait:"stage-wait",stageResults:"stage-results"},rouletteNumbers={red:[1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36],black:[2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35],low:[...Array(18).keys()].map((e=>e+1)),high:[...Array(18).keys()].map((e=>e+19)),odd:[...Array(18).keys()].map((e=>2*(e+1)-1)),even:[...Array(18).keys()].map((e=>2*(e+1))),dozenFirst:[...Array(12).keys()].map((e=>e+1)),dozenSecond:[...Array(12).keys()].map((e=>e+13)),dozenThird:[...Array(12).keys()].map((e=>e+25)),columnTop:[...Array(12).keys()].map((e=>3*(e+1))),columnMiddle:[...Array(12).keys()].map((e=>3*(e+1)-1)),columnBottom:[...Array(12).keys()].map((e=>3*(e+1)-2))};class BetManager{constructor(){this.lastBetTime=Math.floor(Date.now()/1e3)}updateLastBetTime(){this.lastBetTime=Math.floor(Date.now()/1e3)}}class RouletteBetManager extends BetManager{constructor(e,t){super(),this.driver=e,this.config=t,this.lastLogMessage=null,this.state={gameCount:0,pendingGame:null,gameStage:gameState.stageSpin}}async runStrategy(){const e=this.driver.getMessageModal(),t=Math.floor(Date.now()/1e3)-this.lastBetTime;!this.state.pendingGame&&t>900&&window.location.reload(),e&&e.textContent.match(/(inactive|disconnected|restart|unavailable)/g)&&window.location.reload();const s=this.driver.getLastNumber(),o=this.driver.getDealerMessage().toLowerCase();switch(this.state.gameStage){case gameState.stageSpin:this.runStageSpin(o);break;case gameState.stageBet:await this.runStageBet(o);break;case gameState.stageWait:this.runStageWait(o);break;case gameState.stageResults:await this.runStageResult(o,s)}}runStageSpin(e){this.logMessage("waiting for next round"),"wait for the next round"===e&&(this.state.gameStage=gameState.stageBet)}async runStageBet(e){if(this.logMessage("waiting to be able to place bets"),["place your bets","last bets"].includes(e)){if(null===this.state.pendingGame){this.logMessage("no bets in progress");const e=this.driver.getNumberHistory();for(const t in rouletteStrategy){const s=rouletteStrategy[t];let o=!1,i=!1;if(this.isPatternMatching(s.trigger.pattern,e)&&(o=!0),this.isPercentageMatching(s.trigger.distribution,e)&&(i=!0),o&&i){this.logMessage("strategy matched - "+t);(await fetch("http://localhost:8080/bet/").then((e=>e.json()))).success?(this.logMessage("server accepted bet"),this.state.pendingGame={bets:s.bets,progression:s.progression,strategy:t,multiplier:{current:1,limit:s.stopLossLimit}},this.submitBets()):this.logMessage("server refused bet");break}}}else this.logMessage("continue with betting"),this.submitBets();this.state.gameStage=gameState.stageWait}}runStageWait(e){this.logMessage("waiting for next round"),"wait for the next round"===e&&(this.state.gameStage=gameState.stageResults)}async runStageResult(e,t){if(this.logMessage("waiting for result"),["place your bets","last bets"].includes(e)){if(this.logMessage("processing results"),this.state.pendingGame){const e=this.getWinTypes(t),s=rouletteStrategy[this.state.pendingGame.strategy];let o=!1;if(s.bets.forEach((t=>{e.includes(t)&&(o=!0)})),o){(await fetch("http://localhost:8080/result/win/").then((e=>e.json()))).success&&this.logMessage("registered win, resetting state"),this.state.gameCount+=1,this.state.pendingGame=null}else if(this.state.pendingGame.multiplier.current!==this.state.pendingGame.multiplier.limit)this.state.pendingGame.multiplier.current+=1,this.logMessage("lost game, increasing progression multiplier");else{(await fetch("http://localhost:8080/result/lose/").then((e=>e.json()))).success&&this.logMessage("registered loss"),window.location.href="https://www.scienceabc.com/wp-content/uploads/ext-www.scienceabc.com/wp-content/uploads/2019/06/bankruptcy-meme.jpg-.jpg"}}this.state.gameStage=gameState.stageBet}}submitBets(){let e=0;!this.config.dryRun&&this.driver.setChipSize(this.config.chipSize),this.state.pendingGame.bets.forEach((t=>{!this.config.dryRun&&this.driver.setBet(t),e+=this.config.chipSize}));for(let t=1;t<this.state.pendingGame.multiplier.current;t++)!this.config.dryRun&&this.driver.setBetDouble(),e*=2;!this.config.dryRun&&this.updateLastBetTime(),this.logMessage("bets: "+this.state.pendingGame.bets),this.logMessage("total: "+e)}isPercentageMatching(e,t){const s=e[0],o=e[1],i=e[2],a=e[3],r=rouletteNumbers[s],n=t.slice(0,o);let l=0;n.forEach((e=>{r.includes(e)&&(l+=1)}));const c=Math.floor(l/n.length*100);switch(a){case"lowerEqual":return c<=i;case"equal":return c===i;case"higherEqual":return c>=i;default:return!1}}isPatternMatching(e,t){for(const s in e){const o=e[s],i=t[s];if(!this.getWinTypes(i).includes(o))return!1}return!0}getWinTypes(e){const t=[];for(const s in rouletteNumbers)rouletteNumbers[s].includes(e)&&t.push(s);return t}logMessage(e){const t=["console-casino",this.state.gameStage,this.state.gameCount,e];t.toString()!==this.lastLogMessage&&(this.lastLogMessage=t.toString(),console.log(t.join(" - ")))}}class CommonBot{constructor(e){this.driver=e,this.running=!1,this.timeStarted=Math.floor(Date.now()/1e3)}async getConfig(e){const t=e||{};return fetch("http://localhost:8080/config/").then((e=>e.json())).then((e=>{for(const s in e)s in t&&(e[s]=t[s]);return e}))}}class RouletteBot extends CommonBot{async start(e={}){const t=await this.getConfig(e);for(;!this.driver.isGameLoaded();)await this.driver.sleep(1500);const s=await this.driver.getBalance();if(!t.dryRun&&t.minBalance>s)throw new Error("balance too low");if(this.running)throw new Error("already started");this.running=!0;const o=new RouletteBetManager(this.driver,t);for(;this.running;)await o.runStrategy(),await this.driver.sleep(1500)}async stop(){this.running=!1}}class DriverCommon{simulatedClick(e,t){const s=e.ownerDocument.createEvent("MouseEvents"),o=t||{},i={type:"click",canBubble:!0,cancelable:!0,view:e.ownerDocument.defaultView,detail:1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null};for(const e in o)e in o&&(i[e]=o[e]);s.initMouseEvent(i.type,i.canBubble,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget),e.dispatchEvent(s)}sleep(e){return new Promise((t=>setTimeout(t,e)))}}class Playtech extends DriverCommon{constructor(){super(),this.selectors={chip:{.1:"chipsPanel.chip10",.2:"chipsPanel.chip20",.25:"chipsPanel.chip25",.5:"chipsPanel.chip50",1:"chipsPanel.chip100",5:"chipsPanel.chip500",10:"chipsPanel.chip1000",25:"chipsPanel.chip2500",100:"chipsPanel.chip10000",500:"chipsPanel.chip50000",1e3:"chipsPanel.chip100000"},roulette:{even:"betPlace.spots50x50-even",odd:"betPlace.spots50x50-odd",red:"betPlace.spots50x50-red",black:"betPlace.spots50x50-black",low:"betPlace.spots50x50-1to18",high:"betPlace.spots50x50-19to36",columnBottom:"betPlace.column-1",columnMiddle:"betPlace.column-2",columnTop:"betPlace.column-3",firstDozen:"betPlace.dozen-1st12",secondDozen:"betPlace.dozen-2nd12",thirdDozen:"betPlace.dozen-3rd12"}}}isGameLoaded(){return document.querySelector('[class="dealer-message-text"]')}getMessageModal(){return document.querySelector(".modal-confirm_desktop")}getBalance(){const e=document.querySelector('[data-automation-locator="footer.balance"]').textContent;return parseFloat(e.match(/\d+(?:\.\d+)*/g)[0])}getBetAmount(){const e=document.querySelector('[data-automation-locator="footer.betAmount"]').textContent;return parseFloat(e.match(/\d+(?:\.\d+)*/g)[0])}getDealerMessage(){return document.querySelector('[class="dealer-message-text"]').textContent}getDealerName(){return document.querySelector('[data-automation-locator="field.dealerNickname"]').textContent}getNumberHistory(){try{return[...document.querySelector('[class^="roulette-history-extended__items"]').children].map((e=>parseInt(e.textContent)))}catch{this.toggleExtendedHistory();return[...document.querySelector('[class^="roulette-history-extended__items"]').children].map((e=>parseInt(e.textContent)))}}getLastNumber(){const e=document.querySelector('[data-automation-locator="field.lastHistoryItem"]');return parseInt(e.textContent)}getLastNumbers(){return[...document.querySelector(".roulette-game-area__history-line").children[0].children].map((e=>parseInt(e.textContent)))}getWinAmount(){const e=document.querySelector('[data-automation-locator="footer.winAmount"]');return parseFloat(e.textContent.match(/[0-9]+(?:\.[0-9]+)*/g)[0])}setBet(e){this.simulatedClick(document.querySelector(`[data-automation-locator="${this.selectors.roulette[e]}"]`))}setBetDouble(){this.simulatedClick(document.querySelector('[data-automation-locator="button.Double"]'))}setBetUndo(){this.simulatedClick(document.querySelector('[data-automation-locator="button.Undo"]'))}setChipSize(e){this.simulatedClick(document.querySelector(`[data-automation-locator="${this.selectors.chip[e]}"]`))}toggleTableLimits(){this.simulatedClick(document.querySelector('[data-automation-locator="button.limits"]'))}toggleExtendedHistory(){this.simulatedClick(document.querySelector('[data-automation-locator="button.extenededHistory"]'))}toggleStatistics(){this.simulatedClick(document.querySelector('[data-automation-locator="button.statistic"]'))}toggleStatisticsChart(){this.simulatedClick(document.querySelector('[data-automation-locator="button.StatisticChart"]'))}}const rouletteStrategy={redLowOccurrence:{bets:["red"],progression:"martingale",stopLossLimit:8,trigger:{pattern:["black","black"],distribution:["red",100,40,"lowerEqual"]}},blackLowOccurrence:{bets:["black"],progression:"martingale",stopLossLimit:8,trigger:{pattern:["red","red"],distribution:["black",100,40,"lowerEqual"]}},evenLowOccurrence:{bets:["even"],progression:"martingale",stopLossLimit:8,trigger:{pattern:["odd","odd"],distribution:["even",100,40,"lowerEqual"]}},oddLowOccurrence:{bets:["odd"],progression:"martingale",stopLossLimit:8,trigger:{pattern:["even","even"],distribution:["odd",100,40,"lowerEqual"]}},lowLowOccurrence:{bets:["low"],progression:"martingale",stopLossLimit:8,trigger:{pattern:["high","high"],distribution:["low",100,40,"lowerEqual"]}},highLowOccurrence:{bets:["high"],progression:"martingale",stopLossLimit:8,trigger:{pattern:["low","low"],distribution:["high",100,40,"lowerEqual"]}},dozenFirstHighOccurrence:{bets:["dozenSecond","dozenThird"],progression:"martingale",stopLossLimit:7,trigger:{pattern:["dozenFirst","dozenFirst"],distribution:["dozenFirst",100,36,"higherEqual"]}},dozenSecondHighOccurrence:{bets:["dozenFirst","dozenThird"],progression:"martingale",stopLossLimit:7,trigger:{pattern:["dozenSecond","dozenSecond"],distribution:["dozenSecond",100,36,"higherEqual"]}},dozenThirdHighOccurrence:{bets:["dozenFirst","dozenSecond"],progression:"martingale",betLossLimit:7,trigger:{pattern:["dozenThird","dozenThird"],distribution:["dozenThird",100,36,"higherEqual"]}},columnTopHighOccurrence:{bets:["columnMiddle","columnBottom"],progression:"martingale",stopLossLimit:7,trigger:{pattern:["columnTop","columnTop"],distribution:["columnTop",100,36,"higherEqual"]}},columnMiddleHighOccurrence:{bets:["columnTop","columnBottom"],progression:"martingale",stopLossLimit:7,trigger:{pattern:["columnMiddle","columnMiddle"],distribution:["columnMiddle",100,36,"higherEqual"]}},columnBottomHighOccurrence:{bets:["columnTop","columnMiddle"],progression:"martingale",stopLossLimit:7,trigger:{pattern:["columnBottom","columnBottom"],distribution:["columnBottom",100,36,"higherEqual"]}}};